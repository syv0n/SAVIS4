<div class="p-4 flex gap-4" style="margin-bottom: 2rem">
  <!-- Manual Input -->
  <form [formGroup]="formGroupValues" class="flex gap-4">
    <div>
      <h2 class="text-xl font-bold">
        {{ "correlation_manual_input" | translate }}
      </h2>
      <div>
        <p class="italic">{{ "correlation_X_Values" | translate }}</p>
        <textarea
          class="border resize-none border-gray-300 focus:border-gray-500 focus:outline-none rounded-lg"
          id="columnX"
          rows="5"
          placeholder="1,2,3"
          formControlName="xValues"
          style="padding: 0.5rem"
        ></textarea>
      </div>

      <div>
        <div>
          <p class="italic">{{ "correlation_Y_Values" | translate }}</p>
        </div>
        <textarea
          class="border resize-none border-gray-300 focus:border-gray-500 focus:outline-none p-2 rounded-lg"
          id="columnY"
          rows="5"
          placeholder="1,2,3"
          formControlName="yValues"
          style="padding: 0.5rem"
        ></textarea>
      </div>

      <b>{{ "correlation_format_of_input" | translate }}.</b>
      <p>
        {{ "correlation_both_inputs" | translate }}
      </p>
      <div class="flex gap-2">
        <button class="btn" (click)="calculate()">
          {{ "correlation_update_chart" | translate }}
        </button>
        <!-- Integrated file input button -->
        <label class="file-input mx-2">
          <input 
            class="hidden" 
            type="file" 
            (change)="onFileChange($event)" 
            accept=".csv,.xlsx"
            #fileInput>
          <span class="btn">{{ "correlation_choose_file" | translate }}</span>
        </label>
      </div>
    </div>
  </form>

  <div class="w-full">
    <h2 class="text-xl font-bold">
      {{ "correlation_result" | translate
      }}{{ correlationValue1 || "" | translate }}
    </h2>
    <!-- Display regression equation in real-time -->
    <div class="mb-2 text-lg font-semibold text-blue-600" *ngIf="regressionText">
      {{ regressionText }}
    </div>
    <div id="chart-wrap">
      <canvas id="data-chart-1" height="400"></canvas>
    </div>
    
    <!-- File data display section -->
    <div *ngIf="isFileData" class="mt-6 p-4 bg-gray-50 rounded-lg border">
      <h3 class="text-lg font-semibold mb-4 text-gray-800">
        {{ "correlation_file_data" | translate }}
      </h3>
      
      <!-- Column selection -->
      <div class="mb-4">
        <p class="text-sm text-gray-600 mb-3">
          {{ "correlation_select_two_columns" | translate }}
        </p>
        <div class="flex gap-3 items-center">
          <select [formControl]="select1" class="border border-gray-300 rounded px-3 py-2 bg-white focus:border-blue-500 focus:outline-none">
            <option value="" disabled>{{ "correlation_select_column" | translate }}</option>
            <option *ngFor="let header of headers" [ngValue]="header">
              {{ header }}
            </option>
          </select>
          <select [formControl]="select2" class="border border-gray-300 rounded px-3 py-2 bg-white focus:border-blue-500 focus:outline-none">
            <option value="" disabled>{{ "correlation_select_column" | translate }}</option>
            <option *ngFor="let header of headers" [ngValue]="header">
              {{ header }}
            </option>
          </select>
          <button class="btn" (click)="calculateFile()">
            {{ "correlation_update_chart" | translate }}
          </button>
        </div>
      </div>

      <!-- Data table -->
      <div class="overflow-x-auto bg-white rounded border">
        <table class="w-full">
          <thead class="bg-gray-100 border-b">
            <tr>
              <th *ngFor="let header of headers" class="px-4 py-3 text-left text-sm font-medium text-gray-700 border-r last:border-r-0">
                {{ header }}
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let data of fileData; let i = index" class="border-b last:border-b-0 hover:bg-gray-50">
              <td
                *ngFor="let header of headers"
                class="px-4 py-3 text-sm text-gray-900 border-r last:border-r-0"
              >
                {{ data[header] }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

